<!doctype html>
<html>
<head>
<meta charset='utf-8'>
<title>Functional Programming in JavaScript using LiveScript - Part 2</title>

<link rel="canonical" href="http://livescript.net/blog/functional-programming-in-javascript-using-livescript-part-2.html">
<link rel="icon" type="image/png" href="../images/icon.png">

<link href="../bootstrap/themes/cerulean.bootstrap.min.css" rel="stylesheet">
<link href="../bootstrap/css/bootstrap-responsive.css" rel="stylesheet">

<script src="../bootstrap/js/bootstrap.js"></script>

<script src="../google-code-prettify/prettify.js"></script>
<link href="../google-code-prettify/prettify.css" rel="stylesheet">
<script src="../lang-ls-1.1.0.js"></script>

<link href="styles.css" rel="stylesheet">

<script>
  if(window.location.host && window.location.host !== "localhost") {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-7402515-5']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  }
</script>
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="span10 content">
        <h1>Functional Programming in JavaScript using LiveScript - Part 2</h1>
        <div class="date-author">
          <span class="date">9 Jul 2012, updated 30 Jul 2012</span> - <a href="https://twitter.com/#!/gkzahariev" class="author">George Zahariev</a>
        </div>
        
<p>A couple of weeks ago we discussed functional programming in JavaScript using LiveScript. Since then LiveScript has received many updates<span id="hn-notice"> (including some features suggested by <a href="http://news.ycombinator.com/">Hacker News</a> readers)</span>, so it's now time for Part 2!

<p class="note">If you haven't read Part 1, <a href="functional-programming-in-javascript-using-livescript-and-prelude-ls.html">Functional Programming in JavaScript using LiveScript and prelude.ls</a>, I would highly recommend you <a href="functional-programming-in-javascript-using-livescript-and-prelude-ls.html">do so now</a>.

<p>A brief refresher: <a href="http://gkz.github.com/LiveScript/">LiveScript</a> is a language that compiles to JavaScript. It's just JavaScript with some syntax improvements and feature additions, making functional style programming easier. <a href="http://gkz.github.com/prelude-ls/">prelude.ls</a> is its standard library, based off of Haskell's Prelude module.


<h3>Constants</h3>

<p>A major concept in functional programming is <em>immutable values</em>. This means using variables which you can't reassign or modify. Doing this makes it easier to reason about your code, as you never have to worry about the state of your variables - they will only ever have one value. This helps reduce the amount of bugs in your code.

<p>JavaScript does not currently support immutable values, but thanks to <a href="https://github.com/satyr">@satyr</a>, LiveScript now has constants! Errors are thrown at compile time if any reassignment, crementing, or redeclaration of a constant is found. 

<p>They are defined with the <code>const</code> keyword:

<div class="example">
<div class="example-ls">
<pre class="prettyprint lang-ls">
const x = 10
</pre>
</div>
<div class="example-js">
<pre class="prettyprint lang-js">
var x;
x = 10;
</pre>
</div>
</div>

<p>The compiled JavaScript is no different, because as mentioned above there isn't currently widespread support in for constants in JS. Everything is checked at compile time.

<p>All the below would throw errors after the constant <code>x</code> was defined as above.

<pre class="prettyprint lang-ls">
x = 0  # error: redeclaration of constant "x" on line 2
x++    # error: increment of constant "x" on line 2
x += 2 # error: assignment to constant "x" on line 2
</pre>

<p>However, property modification is still allowed:

<pre class="prettyprint lang-ls">
const y = {name: 'amy'}
y.name = 'taylor'   # fine - results in y == {name: 'taylor'}

y = {name: 'hanna'} # not okay - error: redeclaration of constant "y" on line 4
</pre>

<p>Typing out <code>const</code> all the time may be annoying for those who come from languages with immutable variables and want all their variables to be constants.

<p>Use the <code>-k</code> or <code>--const</code> flags when compiling to make the compiler treat all your variables as constants. For example:

<pre>
livescript -ck file.ls
</pre>


<h3>Partial Application</h3>

<p>Curried functions are very useful, but what should you do when the functions you are dealing with aren't curried or don't have their arguments in the order you want?

<p>You can now partially apply functions by calling them using an underscore <code>_</code> as a placeholder for the values you don't want to bind. When you partially apply a function, instead of executing that function, a new function is returned with the arguments you supplied already bound, and the whose arguments are the ones you put the placeholder on.

<div class="example">
<div class="example-ls">
<pre class="prettyprint lang-ls">

filterNums = filter _, [1 to 5]

filterNums even  #=> [2, 4]
filterNums odd   #=> [1, 3, 5]
filterNums (< 3) #=> [1, 2]

# 'filter', 'even', and 'odd' are from prelude.ls
</pre>
</div>
<div class="example-js">
<pre class="prettyprint lang-js">
var filterNums, slice$ = [].slice;
filterNums = partialize$(filter, [void 8, [1, 2, 3, 4, 5]], [0]);
filterNums(even);
filterNums(odd);
filterNums((function(it){
  return it < 3;
}));
function partialize$(f, args, where){
  return function(){
    var params = slice$.call(arguments), i,
        len = params.length, wlen = where.length,
        ta = args ? args.concat() : [], tw = where ? where.concat() : [];
    for(i = 0; i < len; ++i) { ta[tw[0]] = params[i]; tw.shift(); }
    return len < wlen && len ? partialize$(f, ta, tw) : f.apply(this, ta);
  };
}
</pre>
</div>
</div>

<p>If you call a partially applied function with no arguments, it will execute as is instead of returning itself, allowing you to use default arguments.

<p>Partially applied functions are also really useful for piping if the functions you are using don't have a nice argument order and aren't curried (like in underscore.js for instance).

<div class="example">
<div class="example-ls">
<pre class="prettyprint lang-ls">
[1, 2, 3] |> _.map _, (* 2) |> _.reduce _, (+), 0 #=> 12
</pre>
</div>
<div class="example-js">
<pre class="prettyprint lang-js">
var slice$ = [].slice;
partialize$(_.reduce, [
  void 8, curry$(function(x$, y$){
    return x$ + y$;
  }), 0
], [0])(
partialize$(_.map, [
  void 8, (function(it){
    return it * 2;
  })
], [0])(
[1, 2, 3]));
function partialize$(f, args, where){
  return function(){
    var params = slice$.call(arguments), i,
        len = params.length, wlen = where.length,
        ta = args ? args.concat() : [], tw = where ? where.concat() : [];
    for(i = 0; i < len; ++i) { ta[tw[0]] = params[i]; tw.shift(); }
    return len < wlen && len ? partialize$(f, ta, tw) : f.apply(this, ta);
  };
}
function curry$(f, args){
  return f.length > 1 ? function(){
    var params = args ? args.concat() : [];
    return params.push.apply(params, arguments) < f.length && arguments.length ?
      curry$.call(this, f, params) : f.apply(this, params);
  } : f;
}
</pre>
</div>
</div>


<h3>Implicit Access and Lookup Functions</h3>

<p>This feature came as an idea from a <a href="http://news.ycombinator.com/item?id=4136354">Hacker News comment</a>.

<p>When mapping and filtering over collections of objects, it is really useful to have a succinct way to express functions which access properties or call methods.

<pre class="prettyprint lang-ls">
(.prop)
</pre>

<p>is equivalent to

<pre class="prettyprint lang-ls">
((it) -> it.prop)
</pre>

<p>and 


<pre class="prettyprint lang-ls">
(obj.)
</pre>

<p>is equivalent to

<pre class="prettyprint lang-ls">
((it) -> obj[it])
</pre>

<p>Some examples:

<div class="example">
<div class="example-ls">
<pre class="prettyprint lang-ls">

data = [{name: 'alice', age: 19},
        {name: 'tessa', age: 17}]

map (.name), data        #=> ['alice', 'tessa']

filter (.age > 18), data #=> [{name: 'alice', age: 19}] 

map (.toUpperCase!), ['hi', 'there'] #=> ['HI', 'THERE']



map (.join '-'), [[1, 2, 3], [4, 5]] #=> ['1-2-3', '4-5']



m4 = {blength: 15, color: 'black', sites: 'iron'}

map (m4.), ['color', 'sites'] #=> ['black', 'iron']
</pre>
</div>
<div class="example-js">
<pre class="prettyprint lang-js">
var data, m4;
data = [ { name: 'alice', age: 19 },
         { name: 'tessa', age: 17 } ];

map(function(it){ return it.name; }, data);

filter(function(it){ return it.age > 18; }, data);

map(function(it){
  return it.toUpperCase();
}, ['hi', 'there']);

map(function(it){
  return it.join('-');
}, [[1, 2, 3], [4, 5]]);

m4 = { blength: 15, color: 'black', sites: 'iron' };

map(function(it){
  return m4[it];
}, ['color', 'sites']);
</pre>
</div>
</div>


<h3>Include prelude.ls</h3>

<p>We've been using functional functions from <a href="http://gkz.github.com/prelude-ls/">prelude.ls</a> like <code>map</code>, <code>filter</code>, and so on. 

<p>Having to import prelude.ls in every file could become annoying. That's why a compiler flag has been added to automatically import prelude.ls - just use <code>-d</code> or <code>--prelude</code>. For example:

<pre>
livescript -cd file.ls
</pre>

<p>This adds

<pre class="prettyprint lang-js">
if (typeof window != 'undefined' && window !== null) {
  prelude.installPrelude(window);
} else {
  require('prelude-ls').installPrelude(global);
}
</pre>

<p>to the top of every file. The <code>installPrelude</code> function has a check to make sure it only installs itself once if you are including multiple files on the page.


<h3>Arguments Shorthand</h3>

<p>Another recent addition is shorthand for accessing a function's arguments.

<p><code>&0</code> is the first argument, <code>&1</code> is the second, and so on.

<p>A good use case for this is when defining custom functions on which to fold, as those functions require two arguments and can't take advantage of some the other function defining shorthand available. 

<div class="example">
<div class="example-ls">
<pre class="prettyprint lang-ls">
fold1 (-> &0 + &1 * &0), [1, 2, 3] 
#=> 12
</pre>
</div>
<div class="example-js">
<pre class="prettyprint lang-js">
fold1(function(){
  return arguments[0] + arguments[1] * arguments[0];
}, [1, 2, 3]);
</pre>
</div>
</div>


<h3>Destructuring</h3>

<p>Destructuring is a powerful way to extract values from variables. Rather than assigning to a simple variable, you can assign to data structures, which extract the values. For example:


<div class="example">
<div class="example-ls">
<pre class="prettyprint lang-ls">
[first, second] = [1, 2]
first  #=> 1
second #=> 2
</pre>
</div>
<div class="example-js">
<pre class="prettyprint lang-js">
var ref$, first, second;
ref$ = [1, 2], first = ref$[0], second = ref$[1];
first;
second;
</pre>
</div>
</div>

<p>You can also use splats:

<div class="example">
<div class="example-ls">
<pre class="prettyprint lang-ls">
[head, ...tail] = [1 to 5]
head #=> 1
tail #=> [2, 3, 4, 5]



[first, ...middle, last] = [1 to 5]
first  #=> 1
middle #=> [2, 3, 4]
last   #=> 5
</pre>
</div>
<div class="example-js">
<pre class="prettyprint lang-js">
var ref$, head, tail, first, i$, middle, last, slice$ = [].slice;
ref$ = [1, 2, 3, 4, 5], head = ref$[0], tail = slice$.call(ref$, 1);
head;
tail;
ref$ = [1, 2, 3, 4, 5], first = ref$[0], middle = 1 < (i$ = ref$.length - 1) ? slice$.call(ref$, 1, i$) : (i$ = 1, []), last = ref$[i$];
first;
middle;
last;
</pre>
</div>
</div>

<p>...and objects too!

<div class="example">
<div class="example-ls">
<pre class="prettyprint lang-ls">
{name, age} = {weight: 110, name: 'emma', age: 20}
name #=> 'emma'
age  #=> 20
</pre>
</div>
<div class="example-js">
<pre class="prettyprint lang-js">
var ref$, name, age;
ref$ = {
  weight: 110,
  name: 'emma',
  age: 20
}, name = ref$.name, age = ref$.age;
name;
age;
</pre>
</div>
</div>

<p>You can also name the entity which you are destructuring using <code>:label</code>, as well as arbitrarily nest the destructuring. 

<div class="example">
<div class="example-ls">
<pre class="prettyprint lang-ls">
[[x, ...xs]:list1, [y, ...ys]:list2] = [[1, 2, 3], [4, 5, 6]]
x     #=> 1
xs    #=> [2, 3]
list1 #=> [1, 2, 3]
y     #=> 4
ys    #=> [5, 6]
list2 #=> [4, 5, 6]
</pre>
</div>
<div class="example-js">
<pre class="prettyprint lang-js">
var ref$, list1, x, xs, list2, y, ys, slice$ = [].slice;
ref$ = [[1, 2, 3], [4, 5, 6]], list1 = ref$[0], x = list1[0], xs = slice$.call(list1, 1), list2 = ref$[1], y = list2[0], ys = slice$.call(list2, 1);
x;
xs;
list1;
y;
ys;
list2;
</pre>
</div>
</div>


<h3>Switch</h3>

<p>Switch statements are really useful when defining functions. They allow you to cleanly check and return edge cases before the rest of your function body. 

<p>When you don't switch on anything, it is implied that you are switching on <code>true</code> and can thus use expressions evaluating to booleans for your cases. 

<div class="example">
<div class="example-ls">
<pre class="prettyprint lang-ls">
switch
case 5 == 6 
  'never'
case false
  'also never'
case 6 / 2 is 3
  'here'
</pre>
</div>
<div class="example-js">
<pre class="prettyprint lang-js">
switch (false) {
case 5 !== 6:
  'never';
  break;
case !false:
  'also never';
  break;
case 6 / 2 !== 3:
  'here';
}
</pre>
</div>
</div>

<p>(It compiles to switching on <code>false</code> so it can cast the cases with a single not <code>!</code> rather than two.)

<p>Along with using the <code>case</code> keyword, you can use <code>|</code> for <code>case</code> and <code>=&gt;</code> for <code>then</code>. Furthermore, if you follow an arrow <code>-&gt;</code>, assign <code>=</code>, or colon <code>:</code> with a <code>case</code> or <code>|</code>, an empty switch statement is implied.

<p>As well, using either <code>otherwise</code> or <code>_</code> after a case statement compiles to <code>default</code>.

<div class="example">
<div class="example-ls">
<pre class="prettyprint lang-ls">
state = | 2 + 2 == 5 => 'I love Big Brother'
        | _          => 'I love Julia'
</pre>
</div>
<div class="example-js">
<pre class="prettyprint lang-js">
var state;
state = (function(){
  switch (false) {
  case 2 + 2 !== 5:
    return 'I love Big Brother';
  default:
    return 'I love Julia';
  }
}());
</pre>
</div>
</div>

<p>Great for function definitions:

<div class="example">
<div class="example-ls">
<pre class="prettyprint lang-ls">
take(n, [x, ...xs]:list) =
  | n <= 0     => []
  | empty list => []
  | otherwise  => [x] +++ take n - 1, xs
</pre>
</div>
<div class="example-js">
<pre class="prettyprint lang-js">
var take, slice$ = [].slice;
take = curry$(function(n, list){
  var x, xs;
  x = list[0], xs = slice$.call(list, 1);
  switch (false) {
  case !(n <= 0):
    return [];
  case !empty(list):
    return [];
  default:
    return [x].concat(take(n - 1, xs));
  }
});
function curry$(f, args){
  return f.length > 1 ? function(){
    var params = args ? args.concat() : [];
    return params.push.apply(params, arguments) < f.length && arguments.length ?
      curry$.call(this, f, params) : f.apply(this, params);
  } : f;
}
</pre>
</div>
</div>


<h3>Piping Updates</h3>

<p>The forward pipe operator <code>|&gt;</code> now has increased precedence, allowing you to assign a variable to the result of several steps without surrounding the entire thing with parentheses.

<div class="example">
<div class="example-ls">
<pre class="prettyprint lang-ls">
result = 4 |> (+ 1) |> (* 2)
result #=> 10
</pre>
</div>
<div class="example-js">
<pre class="prettyprint lang-js">
var result;
result = (function(it){
  return it * 2;
})(
(function(it){
  return it + 1;
})(
4));
result;
</pre>
</div>
</div>

<p>You can now also partially apply the pipe operator, with multiple arguments.

<div class="example">
<div class="example-ls">
<pre class="prettyprint lang-ls">
map (<| 4, 2), [(+), (*), (/)]
#=> [6, 8, 2]
</pre>
</div>
<div class="example-js">
<pre class="prettyprint lang-js">
map((function(it){
  return it(4, 2);
}), [
  curry$(function(x$, y$){ return x$ + y$; }),
  curry$(function(x$, y$){ return x$ * y$; }),
  curry$(function(x$, y$){ return x$ / y$;
  })
]);
function curry$(f, args){
  return f.length > 1 ? function(){
    var params = args ? args.concat() : [];
    return params.push.apply(params, arguments) < f.length && arguments.length ?
      curry$.call(this, f, params) : f.apply(this, params);
  } : f;
}
</pre>
</div>
</div>


<h3>Conclusion</h3>

<p>This has been a further overview of some of the features available in <a href="http://gkz.github.com/LiveScript/">LiveScript</a> which assist in functional style programming. While we have focused on functional programming, LiveScript is a multi-paradigm language, and has rich support for imperative and object oriented programming - including classes, mixins, super, and more. 

<p>Many people have started using LiveScript in their projects - you can check out a partial list of <a href="https://github.com/gkz/LiveScript/wiki/Projects-using-LiveScript">projects written in LiveScript</a>, and <a href="https://github.com/gkz/LiveScript/wiki/Projects-supporting-LiveScript">projects which support LiveScript</a>.

<p>Have any ideas or suggestions? You can <a href="https://github.com/gkz/LiveScript/issues?direction=desc&sort=updated&state=open">create a ticket on GitHub</a> or ask general questions at the <a href="https://groups.google.com/forum/#!forum/livescript">LiveScript Google Group</a>.

<p>And finally, for more information, <strong><a href="http://gkz.github.com/LiveScript/">check out the LiveScript site</a></strong>.

<style>
  #hn-notice{
    display: none;
  }
</style>
<script>
  if(document.referrer.match(/.*ycombinator.*/)) {
    document.getElementById('hn-notice').style.display = 'inline'
  }
</script>

        <hr>
        <p><a href="https://twitter.com/gkzahariev" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @gkzahariev</a> for more on LiveScript and prelude.ls
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
        if(window.location.host && window.location.host !== "localhost") {
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'livescript'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        }
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
      </div>
      <div class="span2 sidebar">
        <h1><a href="http://livescript.net">LiveScript</a><img src="../images/icon.png"></h1>
        <iframe src="http://ghbtns.com/github-btn.html?user=gkz&repo=LiveScript&type=watch&size=large&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="160" height="40"></iframe>
        <a href="http://livescript.net"><div class="btn btn-primary btn-large btn">LiveScript site</div></a>
        <a href="https://github.com/gkz/LiveScript"><div class="btn btn-large btn">View on GitHub</div></a>
        <a href="http://gkz.github.com/prelude-ls"><div class="btn btn-large btn">prelude.ls site</div></a>
        <div><a href="https://twitter.com/share" class="twitter-share-button" data-via="gkzahariev" data-size="large">Tweet</a></div>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

        <h4>Blog Posts</h4>
        <ul>
          <li><a href="10-things-you-didnt-know-livescript-can-do.html">10 things you didn't know LiveScript can do</a></li>
          <li><a href="livescript-1.1.0.html">LiveScript 1.1.0 Released!</a>
          <li><a href="powerful-jquery-with-livescript.html">Powerful jQuery with LiveScript</a>
          <li><a href="livescript-1.0.0.html">LiveScript 1.0.0 Released</a>
          <li><a href="functional-programming-in-javascript-using-livescript-part-2.html">Functional Programming in JavaScript using LiveScript - Part 2</a>
          <li><a href="ten-reasons-to-switch-from-coffeescript.html">10 Reasons to Switch from CoffeeScript to LiveScript</a>
          <li><a href="functional-programming-in-javascript-using-livescript-and-prelude-ls.html">Functional Programming in JavaScript using LiveScript and prelude.ls</a>
          <li><a href="livescript-one-liners-to-impress-your-friends.html">10 LiveScript One Liners to Impress Your Friends</h3>
        </ul>
      </div>
    </div>
  </div>
<script>
  prettyPrint();
  (document.getElementById("email") || {}).href = "mailto:z" + "@" + "georgezahariev.com";
</script>
</body>
</html>
