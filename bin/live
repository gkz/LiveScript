#!/usr/bin/env node

// Generated by LiveScript 1.6.1
var fs, optionator, path, ref$, List, Obj, lspath, ls, options, option, tasks, task, prepend, mlgth, filler, line, append, findLsc, args, op, opts, e;
fs = require('fs');
optionator = require('optionator');
path = require('path');
ref$ = require('prelude-ls'), List = ref$.List, Obj = ref$.Obj;
lspath = path.join(path.dirname(__filename), '../lib');
ls = require(lspath);
options = [{
  option: 'help',
  alias: 'h',
  type: 'Boolean',
  description: ''
}];
option = function(option, alias, type, description){
  return options.push({
    option: option,
    alias: alias,
    type: type,
    description: description
  });
};
tasks = {};
task = function(name, desc, fn){
  return tasks[name] = {
    desc: desc,
    fn: fn
  };
};
global.option = option;
global.task = task;
try {
  ls.run(
  fs.readFileSync('Livefile', 'utf-8'));
  prepend = 'Usage: live [options]\n\nOptions:';
  mlgth = function(it){
    return it.length;
  }(
  List.maximumBy(function(it){
    return it.length;
  })(
  Obj.keys(tasks)));
  filler = function(str){
    return repeatString$(' ', mlgth - str.length);
  };
  line = function(acc, elt){
    return acc + "" + elt[0] + filler(elt[0]) + "  " + elt[1].desc + "\n";
  };
  append = List.fold(line, 'Commands:\n\n')(
  Obj.objToPairs(tasks));
  findLsc = List.findIndex(function(elt){
    return /lsc$/.exec(elt);
  }, process.argv);
  args = findLsc != null
    ? List.drop(1 + findLsc, process.argv)
    : process.argv;
  args = List.reject(function(elt){
    return /live.ls$/.exec(elt);
  }, process.argv);
  op = optionator({
    append: append,
    options: options,
    prepend: prepend
  });
  opts = op.parseArgv(args);
  switch (false) {
  case !opts.help:
    console.log(op.generateHelp());
    break;
  case opts._.length !== 0:
    console.log('ERROR: no task to run!');
    break;
  case !(opts._.length > 1):
    console.log('ERROR: too many tasks selected!');
    break;
  case in$(opts._[0], Obj.keys(tasks)):
    console.log("ERROR: task does not exist (" + opts._[0] + ")!");
    break;
  default:
    tasks[opts._[0]].fn(opts);
  }
} catch (e$) {
  e = e$;
  switch (e.code) {
  case 'ENOENT':
    console.log('There is no Livefile at this package root');
    break;
  default:
    console.log(e);
  }
}
function repeatString$(str, n){
  for (var r = ''; n > 0; (n >>= 1) && (str += str)) if (n & 1) r += str;
  return r;
}
function in$(x, xs){
  var i = -1, l = xs.length >>> 0;
  while (++i < l) if (x === xs[i]) return true;
  return false;
}